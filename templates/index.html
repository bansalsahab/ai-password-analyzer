<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barclays Password Manager</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                            950: '#1e1b4b',
                        },
                        secondary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                            950: '#2e1065',
                        },
                        dark: {
                            100: '#1e293b',
                            200: '#0f172a',
                            300: '#020617',
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-gradient {
                @apply bg-clip-text text-transparent bg-gradient-to-r from-secondary-500 to-primary-500;
            }
            .btn-gradient {
                @apply bg-gradient-to-r from-primary-600 to-secondary-600 hover:from-primary-700 hover:to-secondary-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg;
            }
            .card {
                @apply bg-white dark:bg-dark-100 rounded-xl shadow-md p-6 transition-all duration-300;
            }
            .card-hover {
                @apply hover:shadow-lg hover:scale-[1.01] transition-all duration-300;
            }
            .security-badge {
                @apply flex items-center justify-center w-20 h-20 rounded-full text-2xl font-bold text-white relative;
            }
            .security-badge-weak {
                @apply bg-red-500;
            }
            .security-badge-moderate {
                @apply bg-yellow-500;
            }
            .security-badge-strong {
                @apply bg-green-500;
            }
            .input-focus {
                @apply focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent;
            }
        }
    </style>
    <!-- Preserve original CSS for JavaScript functionality -->
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body class="bg-gray-50 dark:bg-dark-200 text-gray-800 dark:text-gray-100 min-h-screen transition-colors duration-300">
    <!-- Original elements preserved for JavaScript functionality (hidden with CSS) -->
    <div class="theme-switch-container hidden">
        <label class="theme-switch">
            <input type="checkbox" id="themeToggle">
            <span class="theme-slider"></span>
            <div class="theme-icons">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </div>
        </label>
    </div>
    
    <div class="auth-menu hidden">
        {% if current_user.is_authenticated %}
            <div class="user-info-menu">
                <span class="username-display">{{ current_user.username }}</span>
                <div class="dropdown-menu">
                    <a href="{{ url_for('dashboard') }}" class="menu-item">
                        <i class="fas fa-vault"></i> My Passwords
                    </a>
                    <a href="{{ url_for('logout') }}" class="menu-item">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        {% else %}
            <div class="auth-buttons">
                <a href="{{ url_for('login') }}" class="auth-btn login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </a>
                <a href="{{ url_for('register') }}" class="auth-btn register-btn">
                    <i class="fas fa-user-plus"></i> Register
                </a>
            </div>
        {% endif %}
    </div>
    
    <!-- Header with theme toggle and auth menu (visible) -->
    <header class="sticky top-0 z-50 bg-white/90 dark:bg-dark-100/90 backdrop-blur-md shadow-sm py-3 px-4 md:px-6">
        <div class="container mx-auto flex justify-between items-center">
            <!-- Logo/Title for mobile -->
            <div class="md:hidden">
                <h2 class="text-lg font-bold">Password Analyzer</h2>
            </div>
            
            <!-- Theme toggle switch -->
            <div class="theme-switch-container-tw">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="themeToggleTw" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-300 dark:bg-gray-600 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"></div>
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-700 dark:text-gray-300">
                        <i class="fas fa-moon text-xs"></i>
                    </div>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-700 dark:text-gray-300">
                        <i class="fas fa-sun text-xs"></i>
                    </div>
                </label>
            </div>
            
            <!-- User authentication menu -->
            <div class="auth-menu-tw">
                {% if current_user.is_authenticated %}
                    <div class="user-info-menu-tw relative">
                        <button class="flex items-center space-x-2 bg-gray-100 dark:bg-dark-300 px-3 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-dark-100 transition-colors">
                            <span class="hidden sm:inline text-sm font-medium">{{ current_user.username }}</span>
                            <i class="fas fa-user-circle text-primary-600 dark:text-primary-400"></i>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div class="dropdown-menu-tw hidden absolute right-0 mt-2 w-48 bg-white dark:bg-dark-100 rounded-lg shadow-lg py-2 z-50">
                            <a href="{{ url_for('dashboard') }}" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-dark-300">
                                <i class="fas fa-vault mr-2 text-primary-600 dark:text-primary-400"></i> My Passwords
                            </a>
                            <a href="{{ url_for('logout') }}" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-dark-300">
                                <i class="fas fa-sign-out-alt mr-2 text-primary-600 dark:text-primary-400"></i> Logout
                            </a>
                        </div>
                    </div>
                {% else %}
                    <div class="auth-buttons-tw flex space-x-2">
                        <a href="{{ url_for('login') }}" class="flex items-center px-4 py-2 text-sm font-medium text-primary-600 dark:text-primary-400 bg-white dark:bg-dark-300 rounded-lg border border-primary-600 dark:border-primary-400 hover:bg-primary-50 dark:hover:bg-dark-200 transition-colors">
                            <i class="fas fa-sign-in-alt mr-2"></i> Login
                        </a>
                        <a href="{{ url_for('register') }}" class="flex items-center px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700 transition-colors">
                            <i class="fas fa-user-plus mr-2"></i> Register
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </header>
    
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-container-tw fixed top-20 right-4 z-50 w-full max-w-sm space-y-2">
                {% for category, message in messages %}
                    <div class="flash-message-tw {{ category }} flex items-center p-4 rounded-lg shadow-md animate-fade-in {% if category == 'success' %}bg-green-100 text-green-800 border-l-4 border-green-500{% elif category == 'error' %}bg-red-100 text-red-800 border-l-4 border-red-500{% else %}bg-blue-100 text-blue-800 border-l-4 border-blue-500{% endif %}">
                        <div class="flex-1">{{ message }}</div>
                        <button class="close-flash-tw ml-3 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <div class="analyzer-container-tw container mx-auto px-4 py-8 max-w-6xl">
        <h1 class="text-3xl md:text-4xl font-bold text-center mb-8">
            Barclays Password Manager
            <span class="text-gradient font-extrabold"></span>
        </h1>
        
        <!-- Password input section -->
        <div class="input-container-tw max-w-3xl mx-auto mb-8">
            <div class="relative flex items-center">
                <input type="password" id="passwordInput" placeholder="Enter your password to analyze" class="w-full px-4 py-3 pr-24 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-300 input-focus">
                <button id="togglePassword" class="absolute right-[calc(2.5rem+78px)] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-2">
                    <i class="fas fa-eye text-sm"></i>
                </button>
                <button id="analyzeBtn" class="absolute right-2 btn-gradient gradient-button">
                    Analyze
                </button>
            </div>
            
            {% if current_user.is_authenticated %}
            <div class="mt-3 flex justify-end space-x-2">
                <button onclick="toggleSaveSection()" class="flex items-center space-x-1 text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 text-sm">
                    <i class="fas fa-save mr-1"></i> Save Password Options
                </button>
            </div>
            {% endif %}
        </div>
        
        <!-- Max crack time selector section -->
        <div class="threshold-container-tw max-w-3xl mx-auto mb-12 flex flex-col md:flex-row items-center justify-between gap-4 p-4 bg-white dark:bg-dark-100 rounded-lg shadow-sm">
            <div class="flex items-center">
                <label for="crackTimeThreshold" class="text-sm font-medium mr-3">Maximum acceptable crack time:</label>
                <select id="crackTimeThreshold" class="bg-gray-50 dark:bg-dark-300 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg input-focus block p-2.5">
                    <option value="instant">Instant (Not secure)</option>
                    <option value="seconds">Seconds (Not secure)</option>
                    <option value="minutes">Minutes (Not secure)</option>
                    <option value="hours">Hours (Not secure)</option>
                    <option value="days">Days (Minimum security)</option>
                    <option value="months">Months (Better security)</option>
                    <option value="years">Years (Good security)</option>
                    <option value="centuries" selected>Centuries (Excellent security)</option>
                </select>
            </div>
            <button id="generateBtn" class="btn-gradient gradient-button w-full md:w-auto">
                <i class="fas fa-key mr-2"></i> Generate Secure Password
            </button>
        </div>
        
        <!-- Why Our Password Analyzer Is Unique - Moved below password input -->
        <section class="unique-features-section mb-8 bg-white dark:bg-dark-100 rounded-xl shadow-md overflow-hidden">
            <div class="p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center justify-center">
                    <i class="fas fa-fingerprint text-primary-600 dark:text-primary-400 mr-2"></i>
                    Why Our Password Analyzer Is Unique
                </h2>
                <p class="mb-6 text-gray-700 dark:text-gray-300 text-center">Our AI-powered password analyzer offers advanced features not found in standard tools:</p>
                
                <div class="unique-features grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="unique-feature-card bg-white dark:bg-dark-300 p-5 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        <div class="icon bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 w-12 h-12 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-database text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Full RockYou Dataset</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Cross-references your password against the complete RockYou database of 14.3 million leaked passwords, not just a sample.</p>
                    </div>
                    
                    <div class="unique-feature-card bg-white dark:bg-dark-300 p-5 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        <div class="icon bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 w-12 h-12 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-chart-line text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Future Security Timeline</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Shows how your password security degrades over time with advancing technology, including quantum computing threats.</p>
                    </div>
                    
                    <div class="unique-feature-card bg-white dark:bg-dark-300 p-5 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        <div class="icon bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 w-12 h-12 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-dna text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Password DNA Visualization</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Visualizes the character composition of your password to identify structural weaknesses in your security.</p>
                    </div>
                    
                    <div class="unique-feature-card bg-white dark:bg-dark-300 p-5 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        <div class="icon bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 w-12 h-12 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-brain text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Advanced AI Analysis</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Uses sophisticated neural networks to detect subtle patterns and weaknesses that traditional analyzers miss.</p>
                    </div>
                    
                    <div class="unique-feature-card bg-white dark:bg-dark-300 p-5 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        <div class="icon bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 w-12 h-12 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-key text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Threshold-Based Generation</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Generate passwords that meet specific security requirements based on your desired crack-time threshold.</p>
                    </div>
                    
                    <div class="unique-feature-card bg-white dark:bg-dark-300 p-5 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        <div class="icon bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 w-12 h-12 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-fingerprint text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Memorability Balance</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Uniquely balances security with memorability, so your passwords are both secure and usable.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Loading indicator -->
        <div id="loading" class="hidden">
            <div class="spinner"></div>
            <p>Analyzing with <span class="glowing-text">DeepSeek AI</span>...</p>
            <p>Cross-referencing with 14.3 million leaked passwords...</p>
        </div>
        
        <!-- Modern Loading indicator (visible) -->
        <div id="loading-tw" class="hidden flex flex-col items-center justify-center py-12">
            <div class="spinner w-16 h-16 border-4 border-primary-200 dark:border-primary-900 border-t-primary-600 dark:border-t-primary-400 rounded-full animate-spin mb-4"></div>
            <p class="text-lg font-medium mb-2">Analyzing with <span class="text-gradient font-bold">Advanced AI</span>...</p>
            <p class="text-sm text-gray-600 dark:text-gray-400">Cross-referencing with 14.3 million leaked passwords...</p>
        </div>
        
        <!-- Results container -->
        <div id="resultsContainer" class="hidden">
            <!-- Original content preserved for JavaScript functionality -->
        </div>
        
        <!-- Modern Results container (visible) -->
        <div id="resultsContainer-tw" class="hidden animate-fade-in">
            <!-- Save password section (only for logged-in users) -->
            {% if current_user.is_authenticated %}
            <div id="savePasswordSection-tw" class="save-password-section mb-8 bg-white dark:bg-dark-100 rounded-xl shadow-md overflow-hidden">
                <div class="save-password-header bg-gradient-to-r from-primary-600 to-secondary-600 text-white p-4">
                    <h3 class="text-lg font-semibold flex items-center"><i class="fas fa-save mr-2"></i> Save this password</h3>
                    <p class="text-sm opacity-90">Save this password securely in your encrypted vault</p>
                </div>
                <div class="save-password-form p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="passwordLabel" class="block text-sm font-medium mb-1">Label (optional)</label>
                        <input type="text" id="passwordLabel" placeholder="e.g., Work Email" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-300 input-focus">
                    </div>
                    <div class="form-group">
                        <label for="passwordWebsite" class="block text-sm font-medium mb-1">Website (optional)</label>
                        <input type="text" id="passwordWebsite" placeholder="e.g., example.com" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-300 input-focus">
                    </div>
                    <div class="md:col-span-2">
                        <button id="savePasswordBtn" onclick="savePassword()" class="btn-gradient save-btn w-full">
                            <i class="fas fa-lock mr-2"></i> Save Securely
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <div class="results-grid-tw grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                <!-- Strength card -->
                <div class="result-card-tw strength-card card card-hover">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-shield-alt text-primary-600 dark:text-primary-400 mr-2"></i>
                        Password Strength
                    </h2>
                    <div class="strength-container flex items-center space-x-4">
                        <div class="security-score-badge security-badge security-badge-weak" style="--score: 0%;">0</div>
                        <div class="strength-details flex-1">
                            <div class="strength-label text-sm text-gray-600 dark:text-gray-400">Security Score</div>
                            <div class="strength-rating-label text-lg font-semibold text-red-600 dark:text-red-400">Weak</div>
                            <div id="strengthMeter" class="h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full mt-1 overflow-hidden">
                                <div class="meter-fill h-full bg-red-500 w-0 transition-all duration-500"></div>
                            </div>
                        </div>
                    </div>
                    <div id="scoreValue" class="hidden">0</div>
                    <div class="strength-description mt-4">
                        <div class="strength-tip bg-gray-50 dark:bg-dark-300 p-3 rounded-lg text-sm">
                            <i class="fas fa-info-circle text-primary-600 dark:text-primary-400 mr-2"></i> 
                            <span id="strengthTip">Enter a password to analyze its strength</span>
                        </div>
                        
                        {% if current_user.is_authenticated %}
                        <div class="mt-3 flex justify-end">
                            <button onclick="quickSavePassword()" class="flex items-center space-x-1 text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 text-sm px-3 py-1 border border-primary-500 rounded-lg">
                                <i class="fas fa-bolt mr-1"></i> Quick Save
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Improvement card -->
                <div class="result-card-tw improvement-card card card-hover">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-arrow-up text-primary-600 dark:text-primary-400 mr-2"></i>
                        Improved Password
                    </h2>
                    <div class="improved-password-container">
                        <div class="improvement-label text-sm text-gray-600 dark:text-gray-400 mb-1">Our Suggestion</div>
                        <div class="improved-password-display bg-gray-50 dark:bg-dark-300 p-3 rounded-lg flex items-center justify-between mb-3">
                            <div id="improvedPassword" class="font-mono text-sm"></div>
                            <div class="flex space-x-2">
                                <button id="copyImproved" class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 p-1">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                {% if current_user.is_authenticated %}
                                <button id="saveImproved" onclick="saveImprovedPassword()" class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 p-1">
                                    <i class="fas fa-save"></i> Save
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        <div id="improvementReasoning" class="text-sm text-gray-600 dark:text-gray-400"></div>
                    </div>
                </div>
                
                <!-- Crack time card -->
                <div class="result-card-tw crack-time-card card card-hover">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-stopwatch text-primary-600 dark:text-primary-400 mr-2"></i>
                        Time to Crack
                    </h2>
                    <div id="crackTimeValue" class="large-text text-2xl font-bold text-center py-3 mb-4"></div>
                    <table id="attackTable" class="w-full text-sm">
                        <tr class="bg-gray-50 dark:bg-dark-300">
                            <th class="py-2 px-3 text-left rounded-tl-lg">Attack Vector</th>
                            <th class="py-2 px-3 text-right rounded-tr-lg">Estimated Time</th>
                        </tr>
                    </table>
                </div>
                
                <!-- Entropy card -->
                <div class="result-card-tw entropy-card card card-hover">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-random text-primary-600 dark:text-primary-400 mr-2"></i>
                        Password Entropy
                    </h2>
                    <div class="entropy-container flex items-center space-x-4">
                        <div class="entropy-badge bg-gradient-to-br from-primary-500 to-secondary-600 text-white rounded-full w-20 h-20 flex flex-col items-center justify-center">
                            <span id="entropyValue" class="text-xl font-bold">0</span>
                            <span class="entropy-unit text-xs">bits</span>
                        </div>
                        <div class="entropy-details flex-1">
                            <div class="entropy-label text-sm text-gray-600 dark:text-gray-400">Information Density</div>
                            <div class="entropy-gauge h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full mt-1 mb-2 overflow-hidden">
                                <div class="gauge-fill h-full bg-primary-500 w-0 transition-all duration-500"></div>
                            </div>
                            <div class="gauge-markers flex justify-between text-xs text-gray-500 dark:text-gray-400">
                                <span>Low</span>
                                <span>Medium</span>
                                <span>High</span>
                            </div>
                        </div>
                    </div>
                    <p id="bitsExplanation" class="entropy-explanation text-sm text-gray-600 dark:text-gray-400 mt-3">
                        Entropy measures password randomness
                    </p>
                    <div class="rockyou-check mt-3">
                        <div id="inCommonDb" class="warning hidden bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 p-3 rounded-lg text-sm">
                            <i class="fas fa-exclamation-triangle mr-2"></i> Found in leaked password database
                        </div>
                    </div>
                </div>
                
                <!-- AI analysis card -->
                <div class="result-card-tw ai-card card card-hover">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-robot text-primary-600 dark:text-primary-400 mr-2"></i>
                        AI Security Analysis
                    </h2>
                    <div class="deepseek-output ai-output text-sm space-y-2"></div>
                </div>
                
                <!-- Vulnerability card -->
                <div class="result-card-tw vulnerability-card card card-hover">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-bug text-primary-600 dark:text-primary-400 mr-2"></i>
                        Vulnerability Breakdown
                    </h2>
                    <div id="vulnerabilityBreakdown" class="text-sm space-y-2"></div>
                </div>
                
                <!-- Enhanced visualization section -->
                <div class="result-card-tw full-width card card-hover md:col-span-2 lg:col-span-3">
                    <h2 class="text-xl font-semibold mb-6 flex items-center">
                        <i class="fas fa-chart-line text-primary-600 dark:text-primary-400 mr-2"></i>
                        Advanced Visualizations
                    </h2>
                    <div class="charts-container grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="chart-wrapper vulnerability-chart bg-white dark:bg-dark-300 p-4 rounded-lg shadow-sm">
                            <h3 class="text-base font-medium mb-3 text-center">Password Vulnerability Analysis</h3>
                            <canvas id="attackChart" class="w-full"></canvas>
                        </div>
                        <div class="chart-wrapper dna-chart bg-white dark:bg-dark-300 p-4 rounded-lg shadow-sm">
                            <h3 class="text-base font-medium mb-3 text-center">Character Composition</h3>
                            <canvas id="passwordDnaChart" class="w-full"></canvas>
                        </div>
                        <div class="chart-wrapper radar-chart bg-white dark:bg-dark-300 p-4 rounded-lg shadow-sm">
                            <h3 class="text-base font-medium mb-3 text-center">Password Security Profile</h3>
                            <canvas id="securityRadarChart" class="w-full"></canvas>
                        </div>
                        <div class="chart-wrapper timeline-chart bg-white dark:bg-dark-300 p-4 rounded-lg shadow-sm">
                            <h3 class="text-base font-medium mb-3 text-center">Security Over Time</h3>
                            <canvas id="timeEvolutionChart" class="w-full"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer-tw mt-12 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6">
            <p class="mb-2">Secured by Advanced Neural Networks</p>
            <p>Barclays - Protecting your digital life</p>
        </div>
    </div>
    
    <!-- Save password success/error modal -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="saveModalTitle">Password Saved</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p id="saveModalMessage">Your password has been securely saved in your encrypted vault.</p>
            </div>
            <div class="modal-footer">
                <button id="saveModalClose" class="btn btn-primary">OK</button>
                <a id="viewPasswordsLink" href="{{ url_for('dashboard') }}" class="btn btn-secondary">View All Passwords</a>
            </div>
        </div>
    </div>
    
    <!-- Modern Save password success/error modal -->
    <div id="saveModal-tw" class="modal-tw hidden fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="modal-content bg-white dark:bg-dark-100 rounded-xl shadow-xl max-w-md w-full">
            <div class="modal-header bg-gradient-to-r from-primary-600 to-secondary-600 text-white p-4 rounded-t-xl">
                <h2 id="saveModalTitle-tw" class="text-xl font-semibold">Password Saved</h2>
                <span class="close-modal-tw absolute top-4 right-4 text-white hover:text-gray-200 cursor-pointer">&times;</span>
            </div>
            <div class="modal-body p-6">
                <p id="saveModalMessage-tw" class="text-gray-700 dark:text-gray-300">Your password has been securely saved in your encrypted vault.</p>
            </div>
            <div class="modal-footer p-4 bg-gray-50 dark:bg-dark-300 rounded-b-xl flex justify-end space-x-3">
                <button id="saveModalClose-tw" class="px-4 py-2 bg-gray-200 dark:bg-dark-200 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-dark-100 transition-colors">OK</button>
                <a id="viewPasswordsLink-tw" href="{{ url_for('dashboard') }}" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">View All Passwords</a>
            </div>
        </div>
    </div>
    
    <!-- JavaScript files -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/analyzer.js"></script>
    <script src="/static/js/charts.js"></script>
    <script src="/static/js/password-generator.js"></script>
    
    <script>
        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('themeToggle');
            const themeToggleTw = document.getElementById('themeToggleTw');
            
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.documentElement.classList.add('light');
                document.documentElement.classList.remove('dark');
                themeToggle.checked = true;
                themeToggleTw.checked = true;
            } else {
                document.documentElement.classList.add('dark');
                document.documentElement.classList.remove('light');
            }
            
            // Toggle theme when switch is clicked
            themeToggle.addEventListener('change', function() {
                if (this.checked) {
                    document.body.classList.add('light-mode');
                    document.documentElement.classList.add('light');
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                    themeToggleTw.checked = true;
                } else {
                    document.body.classList.remove('light-mode');
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                    localStorage.setItem('theme', 'dark');
                    themeToggleTw.checked = false;
                }
                
                // Redraw charts if they exist
                if (window.passwordCharts) {
                    Object.values(window.passwordCharts).forEach(chart => {
                        if (chart && typeof chart.update === 'function') {
                            chart.update();
                        }
                    });
                }
            });
            
            // Toggle theme when Tailwind switch is clicked
            themeToggleTw.addEventListener('change', function() {
                if (this.checked) {
                    document.body.classList.add('light-mode');
                    document.documentElement.classList.add('light');
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                    themeToggle.checked = true;
                } else {
                    document.body.classList.remove('light-mode');
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                    localStorage.setItem('theme', 'dark');
                    themeToggle.checked = false;
                }
                
                // Redraw charts if they exist
                if (window.passwordCharts) {
                    Object.values(window.passwordCharts).forEach(chart => {
                        if (chart && typeof chart.update === 'function') {
                            chart.update();
                        }
                    });
                }
            });
            
            // Update security score badge value and rating when score changes
            const scoreValue = document.getElementById('scoreValue');
            const securityBadge = document.querySelector('.security-score-badge');
            const strengthRating = document.querySelector('.strength-rating-label');
            const strengthMeter = document.querySelector('.meter-fill');
            const strengthTip = document.getElementById('strengthTip');
            
            // Create a MutationObserver to watch for changes to the score value
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'characterData' || mutation.type === 'childList') {
                        const score = parseInt(scoreValue.textContent);
                        securityBadge.textContent = score;
                        securityBadge.style.setProperty('--score', `${score}%`);
                        
                        // Update badge color and strength rating based on score
                        if (score < 40) {
                            securityBadge.className = 'security-score-badge security-badge security-badge-weak';
                            strengthRating.textContent = "Weak";
                            strengthRating.className = "strength-rating-label text-lg font-semibold text-red-600 dark:text-red-400";
                            strengthMeter.style.width = score + '%';
                            strengthMeter.className = 'meter-fill h-full bg-red-500 transition-all duration-500';
                            strengthTip.textContent = "Your password is vulnerable to common attacks. Consider adding more complexity.";
                        } else if (score < 70) {
                            securityBadge.className = 'security-score-badge security-badge security-badge-moderate';
                            strengthRating.textContent = "Moderate";
                            strengthRating.className = "strength-rating-label text-lg font-semibold text-yellow-600 dark:text-yellow-400";
                            strengthMeter.style.width = score + '%';
                            strengthMeter.className = 'meter-fill h-full bg-yellow-500 transition-all duration-500';
                            strengthTip.textContent = "Your password has decent strength but could be improved with more variety.";
                        } else {
                            securityBadge.className = 'security-score-badge security-badge security-badge-strong';
                            strengthRating.textContent = "Strong";
                            strengthRating.className = "strength-rating-label text-lg font-semibold text-green-600 dark:text-green-400";
                            strengthMeter.style.width = score + '%';
                            strengthMeter.className = 'meter-fill h-full bg-green-500 transition-all duration-500';
                            strengthTip.textContent = "Your password has excellent security characteristics.";
                        }
                    }
                });
            });
            
            // Start observing the score value
            observer.observe(scoreValue, {
                characterData: true,
                childList: true,
                subtree: true
            });
            
            // Update entropy gauge when entropy value changes
            const entropyValue = document.getElementById('entropyValue');
            const gaugeElement = document.querySelector('.gauge-fill');
            
            // Create a mutation observer for entropy value
            const entropyObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'characterData' || mutation.type === 'childList') {
                        const entropy = parseFloat(entropyValue.textContent);
                        
                        // Set gauge fill percentage based on entropy (max around 100 bits)
                        let percentage = Math.min(100, entropy / 100 * 100);
                        gaugeElement.style.width = `${percentage}%`;
                        
                        // Set color based on entropy value
                        if (entropy < 40) {
                            gaugeElement.style.backgroundColor = 'rgb(239, 68, 68)';
                        } else if (entropy < 70) {
                            gaugeElement.style.backgroundColor = 'rgb(234, 179, 8)';
                        } else {
                            gaugeElement.style.backgroundColor = 'rgb(34, 197, 94)';
                        }
                    }
                });
            });
            
            // Start observing the entropy value
            entropyObserver.observe(entropyValue, {
                characterData: true,
                childList: true,
                subtree: true
            });
            
            // Sync original and Tailwind UI
            // Show/hide loading indicator
            const originalObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const originalLoading = document.getElementById('loading');
                        const twLoading = document.getElementById('loading-tw');
                        const originalResults = document.getElementById('resultsContainer');
                        const twResults = document.getElementById('resultsContainer-tw');
                        const uniqueFeatures = document.querySelector('.unique-features-section');
                        
                        if (originalLoading.classList.contains('hidden')) {
                            twLoading.classList.add('hidden');
                        } else {
                            twLoading.classList.remove('hidden');
                            // Hide the unique features when loading
                            uniqueFeatures.classList.add('hidden');
                        }
                        
                        if (originalResults.classList.contains('hidden')) {
                            twResults.classList.add('hidden');
                            // Show unique features when results are hidden
                            uniqueFeatures.classList.remove('hidden');
                        } else {
                            twResults.classList.remove('hidden');
                            // Hide unique features when showing results
                            uniqueFeatures.classList.add('hidden');
                        }
                    }
                });
            });
            
            // Observe the original loading and results containers
            originalObserver.observe(document.getElementById('loading'), { attributes: true });
            originalObserver.observe(document.getElementById('resultsContainer'), { attributes: true });
            
            // Sync the original and Tailwind UI for the save modal
            const saveModal = document.getElementById('saveModal');
            const saveModalTw = document.getElementById('saveModal-tw');
            const saveModalTitle = document.getElementById('saveModalTitle');
            const saveModalTitleTw = document.getElementById('saveModalTitle-tw');
            const saveModalMessage = document.getElementById('saveModalMessage');
            const saveModalMessageTw = document.getElementById('saveModalMessage-tw');
            const viewPasswordsLink = document.getElementById('viewPasswordsLink');
            const viewPasswordsLinkTw = document.getElementById('viewPasswordsLink-tw');
            
            // Override the showSaveModal function to update both modals
            window.showSaveModal = function(title, message, success) {
                saveModalTitle.textContent = title;
                saveModalTitleTw.textContent = title;
                saveModalMessage.textContent = message;
                saveModalMessageTw.textContent = message;
                viewPasswordsLink.style.display = success ? 'inline-block' : 'none';
                viewPasswordsLinkTw.style.display = success ? 'inline-block' : 'none';
                
                saveModal.style.display = 'flex';
                saveModalTw.classList.remove('hidden');
            };
            
            // Close save modal (original)
            document.querySelector('#saveModal .close-modal').addEventListener('click', function() {
                saveModal.style.display = 'none';
                saveModalTw.classList.add('hidden');
            });
            
            document.getElementById('saveModalClose').addEventListener('click', function() {
                saveModal.style.display = 'none';
                saveModalTw.classList.add('hidden');
            });
            
            // Close save modal (Tailwind)
            document.querySelector('#saveModal-tw .close-modal-tw').addEventListener('click', function() {
                saveModal.style.display = 'none';
                saveModalTw.classList.add('hidden');
            });
            
            document.getElementById('saveModalClose-tw').addEventListener('click', function() {
                saveModal.style.display = 'none';
                saveModalTw.classList.add('hidden');
            });
            
            // Close flash messages
            document.querySelectorAll('.close-flash').forEach(button => {
                button.addEventListener('click', function() {
                    this.parentElement.remove();
                });
            });
            
            document.querySelectorAll('.close-flash-tw').forEach(button => {
                button.addEventListener('click', function() {
                    this.parentElement.remove();
                });
            });
            
            // User dropdown menu toggle
            const userMenu = document.querySelector('.user-info-menu');
            if (userMenu) {
                userMenu.addEventListener('click', function(e) {
                    const dropdown = this.querySelector('.dropdown-menu');
                    dropdown.classList.toggle('active');
                    e.stopPropagation();
                });
            }
            
            const userMenuTw = document.querySelector('.user-info-menu-tw');
            if (userMenuTw) {
                userMenuTw.addEventListener('click', function(e) {
                    const dropdown = this.querySelector('.dropdown-menu-tw');
                    dropdown.classList.toggle('hidden');
                    e.stopPropagation();
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function() {
                    const dropdown = document.querySelector('.dropdown-menu-tw');
                    if (dropdown) {
                        dropdown.classList.add('hidden');
                    }
                });
            }
        });
    </script>
    
    <!-- Add save password functionality -->
    <script>
        // Function to save password to user account
        function savePassword() {
            // Get the current password and details
            const password = document.getElementById('passwordInput').value;
            const label = document.getElementById('passwordLabel').value || 'Unnamed Password';
            const website = document.getElementById('passwordWebsite').value || '';
            
            // Get security score and entropy from analysis results
            const score = document.getElementById('scoreValue').textContent;
            const entropy = document.getElementById('entropyValue').textContent;
            
            // Create data object to send to server
            const data = {
                password: password,
                label: label,
                website: website,
                score: parseInt(score),
                entropy: parseFloat(entropy)
            };
            
            // Send POST request to save-password endpoint
            fetch('/save-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    // Show success modal
                    showSaveModal('Password Saved', 'Your password has been securely saved in your encrypted vault.', true);
                } else {
                    // Show error modal
                    showSaveModal('Error', result.error || 'Failed to save password. Please try again.', false);
                }
            })
            .catch(error => {
                console.error('Error saving password:', error);
                showSaveModal('Error', 'An error occurred while saving your password. Please try again.', false);
            });
        }
        
        // Function to save the improved password suggestion
        function saveImprovedPassword() {
            // Get the improved password from the suggestion
            const improvedPassword = document.getElementById('improvedPassword').textContent;
            // Use the same label and website inputs from the save form
            const label = document.getElementById('passwordLabel').value || 'Improved Password';
            const website = document.getElementById('passwordWebsite').value || '';
            
            // Get the improved security score and entropy
            // We can use the existing score and entropy values as an approximation
            // In a real application, we would reanalyze the improved password
            const score = document.getElementById('scoreValue').textContent;
            const entropy = document.getElementById('entropyValue').textContent;
            
            // Create data object to send to server
            const data = {
                password: improvedPassword,
                label: label + ' (Improved)',
                website: website,
                score: parseInt(score) + 20, // Improved score is typically higher
                entropy: parseFloat(entropy) * 1.2 // Improved entropy is typically higher
            };
            
            // Send POST request to save-password endpoint
            fetch('/save-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    // Show success modal
                    showSaveModal('Improved Password Saved', 'The improved password suggestion has been securely saved in your encrypted vault.', true);
                } else {
                    // Show error modal
                    showSaveModal('Error', result.error || 'Failed to save improved password. Please try again.', false);
                }
            })
            .catch(error => {
                console.error('Error saving improved password:', error);
                showSaveModal('Error', 'An error occurred while saving the improved password. Please try again.', false);
            });
        }
        
        // Function to toggle the save password section visibility
        function toggleSaveSection() {
            const saveSection = document.getElementById('savePasswordSection-tw');
            if (saveSection) {
                // Toggle visibility (if already in view, scroll to it)
                if (saveSection.classList.contains('hidden')) {
                    saveSection.classList.remove('hidden');
                    saveSection.scrollIntoView({ behavior: 'smooth' });
                } else {
                    // Already visible, just scroll to it
                    saveSection.scrollIntoView({ behavior: 'smooth' });
                }
                
                // Highlight the section briefly
                saveSection.classList.add('ring-4', 'ring-primary-500', 'ring-opacity-50');
                setTimeout(() => {
                    saveSection.classList.remove('ring-4', 'ring-primary-500', 'ring-opacity-50');
                }, 1500);
            } else {
                console.error('Save password section not found');
            }
        }
        
        // Function for quick save of the current password
        function quickSavePassword() {
            // Get the current password
            const password = document.getElementById('passwordInput').value;
            
            // Quick label with timestamp
            const now = new Date();
            const timestamp = now.toISOString().slice(0, 19).replace('T', ' ');
            const label = 'Password from ' + timestamp;
            
            // Get security score and entropy from analysis results
            const score = document.getElementById('scoreValue').textContent;
            const entropy = document.getElementById('entropyValue').textContent;
            
            // Create data object to send to server
            const data = {
                password: password,
                label: label,
                website: '',
                score: parseInt(score),
                entropy: parseFloat(entropy)
            };
            
            // Send POST request to save-password endpoint
            fetch('/save-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    // Show success notification (more subtle than modal)
                    showToast('Password Saved', 'Password saved to your vault');
                } else {
                    // Show error notification
                    showToast('Error', result.error || 'Failed to save password', 'error');
                }
            })
            .catch(error => {
                console.error('Error quick saving password:', error);
                showToast('Error', 'An error occurred while saving your password', 'error');
            });
        }
        
        // Simple toast notification function
        function showToast(title, message, type = 'success') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 z-50 p-4 rounded-lg shadow-lg flex items-start space-x-3 transition-all transform translate-y-0 duration-500 ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            
            // Add content
            toast.innerHTML = `
                <div class="flex-shrink-0 mt-0.5">
                    <i class="fas ${type === 'success' ? 'fa-check-circle text-green-500' : 'fa-exclamation-circle text-red-500'}"></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-sm font-semibold">${title}</h4>
                    <p class="text-xs">${message}</p>
                </div>
                <button class="flex-shrink-0 text-gray-500 hover:text-gray-700" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add to body
            document.body.appendChild(toast);
            
            // Auto dismiss
            setTimeout(() => {
                toast.classList.add('translate-y-full', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }
    </script>
    
    <!-- Add event handler to the analyze button to hide the unique features section -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const uniqueFeatures = document.querySelector('.unique-features-section');

            analyzeBtn.addEventListener('click', function() {
                // Hide the unique features when the analyze button is clicked
                uniqueFeatures.classList.add('hidden');
            });
        });
    </script>
</body>
</html>